<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Vincular Navegador WhatsApp</title>
    <meta http-equiv="refresh" content="10"> <!-- Auto-refrescar cada 10s para ver si cambi√≥ el estado -->
         <style>
            body { font-family: sans-serif; text-align: center; padding: 50px; background-color: #f0f2f5; }
            .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: inline-block; }
            img { border: 1px solid #ddd; margin: 20px 0; }
            .status { font-weight: bold; padding: 10px; border-radius: 5px; margin-bottom: 20px; }
            .status.YA_VINCULADO { background-color: #d1e7dd; color: #0f5132; }
            .status.BOT_ACTIVO { background-color: #cfe2ff; color: #084298; }
            .status.INICIANDO_BOT { background-color: #e2e3e5; color: #41464b; }
            .status.ESPERANDO_ESCANEO { background-color: #fff3cd; color: #664d03; }
            .status.ERROR { background-color: #f8d7da; color: #842029; }
        </style>
    </head>
    <body>

        <div class="card">
            <h2>üñ•Ô∏è Instancia de Navegador</h2>

            <div class="status {{ estado }}">
                Estado: {{ estado }}
            </div>

            {% if estado == "BOT_ACTIVO" %}
                <p>ü§ñ <b>El Bot est√° operando correctamente.</b></p>
                <p>El sistema est√° leyendo y respondiendo mensajes en segundo plano.</p>
                <br>
                <img src="https://upload.wikimedia.org/wikipedia/commons/b/bd/Checkmark_green.svg" width="50" alt="Check">

            {% elif estado == "INICIANDO_BOT" %}
                <p>‚öôÔ∏è Vinculaci√≥n exitosa. Iniciando motor de IA...</p>
                <p>Por favor espera, la p√°gina se actualizar√° en unos segundos.</p>

            {% elif estado == "YA_VINCULADO" %}
                <!-- Este estado ser√° transitorio, casi no se ver√° -->
                <p>‚úÖ Conexi√≥n establecida.</p>

            {% elif estado == "ESPERANDO_ESCANEO" and qr_image %}
                <p>Escanea este c√≥digo QR con tu aplicaci√≥n de WhatsApp:</p>
                <img src="data:image/png;base64,{{ qr_image }}" alt="QR Code WhatsApp Web" />
                <p><small>La p√°gina se actualizar√° autom√°ticamente...</small></p>

            {% elif estado == "BOT_OCUPADO" %}
                <p>‚è≥ El bot est√° ocupado procesando un mensaje.</p>
                <p>Reintentando conexi√≥n visual...</p>

            {% else %}
                <p>Iniciando navegador, por favor espera...</p>
            {% endif %}

            <br>
            <a href="{% url 'dashboard' %}">Volver al Dashboard</a>
        </div>

    </body>
    </html>